<?xml version='1.0' ?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/">

<script>
      loadingStatus = 0;
      elapsedTime = "";
      info_currentSong = "";
      info_streamTitle = "";
      info_contentType = "";
      info_streamGenre = "";
      info_streamStatus = "";
      info_averageListenTime = "";
      storagePath = getStoragePath("tmp");
      storagePath_playback = storagePath + "shoutcastPlayURL.dat";
      storagePath_title = storagePath + "shoutcastPlayTitle.dat";
      showLoading = 0;
</script>

<onEnter>
      setRefreshTime(100);
      startVideo = 1;
</onEnter>

<onExit>
      playItemURL(-1, 1);
      setRefreshTime(-1);
</onExit>

<onRefresh>
      vidProgress = getPlaybackStatus();
      bufProgress = getCachedStreamDataSize(0, 262144);
      playElapsed = getStringArrayAt(vidProgress, 0);
      playStatus = getStringArrayAt(vidProgress, 3);
      print("Video status !!!!", vidProgress);
      
      if (startVideo == 1) {
          print("I am moviePlayback onEnter !! startVideo: ", startVideo);
          content = readStringFromFile(storagePath_playback);
          streamURL = content + ",stream";
          playItemURL(streamURL, 0, "mediaDisplay", "previewWindow");
          setRefreshTime(1000);
          showLoading = 1;
          startVideo = 0;
          updatePlaybackProgress(bufProgress, "mediaDisplay", "progressBar");
      } 
      else {
        if (playElapsed != 0) 
        {
            x = Integer(playElapsed / 60);
            h = Integer(playElapsed / 3600);
            s = playElapsed - (x * 60);
            m = x - (h * 60);
            elapsedTime = sprintf("%s:", h);
            if(m &lt; 10)  elapsedTime += "0";
            elapsedTime += sprintf("%s:", m);
            if(s &lt; 10)  elapsedTime += "0";
            elapsedTime += sprintf("%s", s);
            print("elapsedTime =", elapsedTime);
            if (startVideo == 0) {
                updatePlaybackProgress("delete", "mediaDisplay", "progressBar");
                startVideo = 2;
                statusCounter = 0;
                statusTimeout = 1;
            }
            else if(startVideo &gt;= 2)
            {
              statusCounter += 1;
              print("statusCounter =", statusCounter);
              if (statusCounter &gt;= statusTimeout)
              {
                if (startVideo == 2)
                {
                  startVideo = 3;
                  statusTimeout = 60;
                }
                statusCounter = 0;
                
                if (loadingStatus == 0)
                {
                  loadingStatus = 1;
                  statusUrl = content;
                  dlok = loadXMLFile(statusUrl);
                  if (dlok != null)
                  {
                  	itemSize = getXMLElementCount("info","item");
                  	print("Item Size = ", itemSize);
                  
                  	count=0;
                  	while(itemSize != 0)
                  	{
                    		name = getXMLText("info","item",count,"name");
                    		value = getXMLText("info","item",count,"value");
                    		if(name == "Current Song:")
                    		{
                    		  info_currentSong = value;
                    		}
                    		else if(name == "Stream Title:")
                    		{
                    		  info_streamTitle = value;
                    		}
                    		else if(name == "Content Type:")
                    		{
                    		  info_contentType = value;
                    		}
                    		else if(name == "Stream Genre:")
                    		{
                    		  info_streamGenre = value;
                    		}
                    		else if(name == "Stream Status:")
                    		{
                    		  info_streamStatus = value;
                    		}
                    		else if(name == "Average Listen Time:")
                    		{
                    		  info_averageListenTime = value;
                    		}
                    		count += 1;
                  	  	if (count == itemSize)
                    		{
                  			  break;
                  	  	}
                  	}
                  	print("info_currentSong =", info_currentSong);
                  	loadingStatus = 0;
                  }
                }

              }
            }
          	redrawDisplay();
        } 
        else if (playStatus == 0) {
            print("Video quit, return!");
            postMessage("return");
        }
        else {
            print("no playing yet, update buffer progress ", bufProgress);
            updatePlaybackProgress(bufProgress, "mediaDisplay", "progressBar");
        }
      }
</onRefresh>

<mediaDisplay name=threePartsView
    showDefaultInfo = "no"
		sideLeftWidthPC = 0
		sideRightWidthPC = 0
    backgroundColor="8:8:8">
    <text offsetXPC=5 offsetYPC=0 widthPC=100 heightPC=20 fontSize=22 backgroundColor=8:8:16 foregroundColor=200:200:200>
    <script>
       tit = readStringFromFile(storagePath_title);    
       tit;
    </script>
    </text>
		<image offsetXPC=0 offsetYPC=17 widthPC=100 heightPC=1>
			image/gradient_line.bmp
		</image>

    <text offsetXPC=10 offsetYPC=25 widthPC=17 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=40:200:200>
      Stream Status: 
    </text>
    <text offsetXPC=27 offsetYPC=25 widthPC=65 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=200:200:200>
      <script>info_streamStatus;</script>
    </text>

    <text offsetXPC=10 offsetYPC=30 widthPC=17 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=40:200:200>
      Average Listen: 
    </text>
    <text offsetXPC=27 offsetYPC=30 widthPC=65 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=200:200:200>
      <script>info_averageListenTime;</script>
    </text>

    <text offsetXPC=10 offsetYPC=35 widthPC=17 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=40:200:200>
      Stream Title: 
    </text>
    <text offsetXPC=27 offsetYPC=35 widthPC=65 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=200:200:200>
      <script>info_streamTitle;</script>
    </text>

    <text offsetXPC=10 offsetYPC=40 widthPC=17 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=40:200:200>
      Content Type: 
    </text>
    <text offsetXPC=27 offsetYPC=40 widthPC=65 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=200:200:200>
      <script>info_contentType;</script>
    </text>

    <text offsetXPC=10 offsetYPC=45 widthPC=17 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=40:200:200>
      Stream Genre: 
    </text>
    <text offsetXPC=27 offsetYPC=45 widthPC=65 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=200:200:200>
      <script>info_streamGenre;</script>
    </text>

    <text offsetXPC=10 offsetYPC=60 widthPC=17 heightPC=5 fontSize=16 backgroundColor=8:8:8 foregroundColor=40:200:200>
      Current Song: 
    </text>
    <text lines="2" offsetXPC=27 offsetYPC=60 widthPC=65 heightPC=10 fontSize=16 backgroundColor=8:8:8 foregroundColor=200:200:200>
      <script>info_currentSong;</script>
    </text>

    <previewWindow windowColor=8:8:8 offsetXPC=95 offsetYPC=95 widthPC=5 heightPC=5>
    </previewWindow>

    <text offsetXPC=10 offsetYPC=85 widthPC=50 heightPC=5 fontSize=20 backgroundColor=8:8:8 foregroundColor=100:100:100>
      <script>elapsedTime;</script>
    </text>

    <progressBar backgroundColor=-1:-1:-1, offsetXPC=25 offsetYPC=75 widthPC=60 heightPC=20>
    	<bar offsetXPC=20 offsetYPC=48 widthPC=60 heightPC=6 barColor=200:200:200 progressColor=26:129:211 bufferColor=-1:-1:-1/>
    	<text offsetXPC=0 offsetYPC=40 widthPC=20 heightPC=20 fontSize=15 backgroundColor=-1:-1:-1 foregroundColor=200:200:200>
    	  <script>
    	        if (playStatus == 2) {
                showstr = "buffering...";
    		      } else {
    		        showstr = "tune in...";
    		      }
    		      showstr;
    	  </script>
    	</text>
    	<destructor offsetXPC=0 offsetYPC=0 widthPC=100 heightPC=100 color=-1:-1:-1>
    	</destructor>
    </progressBar>

<onUserInput>
input = currentUserInput();
print("*************************",input);
ret = "false";
if (input == "setup" || input == "guide")
{
  playItemURL(-1, 1);
  setRefreshTime(-1);
	postMessage("return");
	postMessage(input);
	ret = "true";
}
else if (input == "display")
{
  statusCounter = statusTimeout;
  ret = "false";
}
ret;
</onUserInput>

</mediaDisplay>

<channel>
	<title>Shoutcast Radio Play</title>
	<link>./rss/shoutcast/radio_shoutcastPlay.rss</link>
</channel>

</rss>
